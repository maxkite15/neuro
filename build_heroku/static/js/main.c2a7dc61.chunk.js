(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{115:function(e,t){},225:function(e){e.exports={}},226:function(e){e.exports={}},227:function(e){e.exports={}},228:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(43),i=a.n(r),s=a(81),c=a(23),l=a(24),u=a(26),d=a(25),h=a(2),g=a(27),p=a(82),m=a.n(p),v=a(45),f=a(44),b=a(5),y=a.n(b),D=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).chartEl=null,a.state={chartOpt:{legend:{display:!1},scales:{xAxes:[{stacked:!0,offset:!0,ticks:{beginAtZero:!0}}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}]},maintainAspectRatio:!1}},a.chartRef=o.a.createRef(),a.updateChartData=a.updateChartData.bind(Object(h.a)(a)),a}return Object(g.a)(t,e),Object(l.a)(t,[{key:"updateChartData",value:function(){var e=this.chartRef.current.getContext("2d");this.chartEl=new y.a(e,{type:"bar",data:{labels:this.props.labels,datasets:[{label:this.props.label,data:this.props.data,backgroundColor:"rgba(".concat(this.props.color.join(","),", 0.6)"),borderColor:"rgba(".concat(this.props.color.join(","),", 1)"),borderWidth:2,hoverBorderWidth:0}]},options:this.state.chartOpt})}},{key:"render",value:function(){var e=this.state.chartOpt,t=[];this.props.content.forEach(function(e){t.push({label:e.label,data:e.data,backgroundColor:"rgba(".concat(e.color.join(","),", 0.6)"),borderColor:"rgba(".concat(e.color.join(","),", 1)"),borderWidth:2,hoverBorderWidth:0})});var a={labels:this.props.labels,datasets:t};return this.props.showLegend&&(e.legend.display=!0),e.scales.xAxes[0].scaleLabel={display:!0,labelString:this.props.xLabel,fontColor:"black"},e.scales.yAxes[0].scaleLabel={display:!0,labelString:this.props.yLabel,fontColor:"black"},o.a.createElement(o.a.Fragment,null,o.a.createElement(f.a,{data:a,options:e}))}}]),t}(n.PureComponent),k=(a(225),a(226),a(227),null),T=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).startTimeHour=null,a.endTimeHour=null,a.prevDaysCount=null,a.isPerfomanceStacked=null,a.tokenVal=null,console.log("Access token: ",a.tokenVal),a.state={clientId:"",redirectUri:"",stateVal:"",labels:[],chartsData:{},prevDaysChartsData:{},startDate:new Date,selectedType:"currDay"},a.getLabel=a.getLabel.bind(Object(h.a)(a)),a.formatData=a.formatData.bind(Object(h.a)(a)),a.initData=a.initData.bind(Object(h.a)(a)),a.getChartData=a.getChartData.bind(Object(h.a)(a)),a.getDataByTimeout=a.getDataByTimeout.bind(Object(h.a)(a)),a.updateData=a.updateData.bind(Object(h.a)(a)),a.getPreviousDayData=a.getPreviousDayData.bind(Object(h.a)(a)),a.lastHour=-1,a.lastMinutes=-1,a.background={stress:[255,7,7],cognitiveLoad:[140,140,140],lucidity:[0,204,255],performance:[1,187,0],in_range:[71,0,212]},a}return Object(g.a)(t,e),Object(l.a)(t,[{key:"getDateTimeStr",value:function(e,t,a){return a||(a=new Date),this.getDateKey(a.getFullYear(),a.getMonth(),a.getDate())+"T"+this.getTimeKey(e,t)+":00"}},{key:"componentDidMount",value:function(){var e=this;console.log("DID MOUNT");var t=this;(k=m.a.apply(this,["http://pacific-everglades-70974.herokuapp.com"])).on("NewToken",function(t){console.log("NEW TOKEN DATA: ",t),e.tokenVal=t.token;var a=1e3*t.expires_in;setTimeout(function(){var e=document.getElementById("updateTokenLink");e.href=t.auth_url,e.click()},a)}),k.on("appConfig",function(e){var a=e;t.startTimeHour=a&&(a.dayStartHour||0===a.dayStartHour)?a.dayStartHour:9,t.endTimeHour=a&&(a.dayEndHour||0===a.dayEndHour)?a.dayEndHour:18,t.prevDaysCount=a&&a.prevDaysCount?a.prevDaysCount:0,t.isPerfomanceStacked=!(!a||!a.perfomanceStacked);var n=new Date,o=n.getHours(),r=n.getMinutes(),i="Start=".concat(t.getDateTimeStr(t.startTimeHour,0),"&Stop=").concat(t.getDateTimeStr(o,r)),s=t.initData(o,r);if(t.updateData(s,i,"chartsData").then(function(e){console.log(e),t.getDataByTimeout(!0)},function(e){console.log("DID MOUNT ERROR: ",e)}),t.prevDaysCount)for(var c=new Date;t.prevDaysCount>0;)t.getPreviousDayData(c),t.prevDaysCount--})}},{key:"updateData",value:function(e,t,a){var n=this,o=this;return new Promise(function(r,i){Promise.all([n.getChartData("/chart_data?".concat(t,"&Group=feedback&Class=trigger-negative&Kind=Stress_Flag")),n.getChartData("/chart_data?".concat(t,"&Group=feedback&Class=trigger-negative&Kind=CognitiveLoad_Flag")),n.getChartData("/chart_data?".concat(t,"&Group=bio&Class=mental&Kind=Lucidity_Avg"))]).then(function(t){console.log("RESULT: ",t);var n=t[0].data,i=t[1].data,c=t[2].data;o.formatData(n,e,"stress","prevDaysChartsData"===a),o.formatData(i,e,"cognitiveLoad","prevDaysChartsData"===a),o.formatData(c,e,"lucidity","prevDaysChartsData"===a),o.setState(Object(s.a)({},a,e)),r("Data updated")},function(e){v.NotificationManager.error(e.message,"Error",5e3),i(e)})})}},{key:"getPreviousDayData",value:function(e){e.setDate(e.getDate()-1);var t=this.getDateKey(e.getFullYear(),e.getMonth(),e.getDate());console.log("KEY=",t);var a=this.state.prevDaysChartsData;a[t]={};var n="Start=".concat(this.getDateTimeStr(this.startTimeHour,0,e),"&Stop=").concat(this.getDateTimeStr(this.endTimeHour,0,e));console.log(n),this.updateData(a,n,"prevDaysChartsData").then(function(e){console.log("Success prev day data update: ",e)},function(e){console.log("Prev day data update ERROR: ",e)})}},{key:"increaseTimeKey",value:function(){this.lastMinutes<40?this.lastMinutes+=20:(this.lastHour++,this.lastMinutes=this.lastMinutes+20-60)}},{key:"getDataByTimeout",value:function(e){var t=this,a=12e5,n=this;if(e){var o=new Date,r=o.getHours(),i=o.getMinutes();a=60*(r<this.lastHour&&0===this.lastMinutes?60-i:r===this.lastHour&&this.lastMinutes>i?this.lastMinutes-i:20)*1e3}function s(){n.increaseTimeKey(),n.lastHour<n.endTimeHour||n.lastHour===n.endTimeHour&&0===n.lastMinutes?n.getDataByTimeout(!1):setTimeout(function(){n.getPreviousDayData(new Date),n.getDataByTimeout(!1)},60*(24-n.endTimeHour+n.startTimeHour)*60*1e3)}setTimeout(function(){var e=n.state.chartsData;e[t.getTimeKey(n.lastHour,n.lastMinutes)]={};var a="Start=\n            ".concat(n.getDateTimeStr(0===n.lastMinutes?n.lastHour-1:n.lastHour,0===n.lastMinutes?40:n.lastMinutes-20),"\n            &Stop=\n            ").concat(n.getDateTimeStr(n.lastHour,n.lastMinutes));n.updateData(e,a,"chartsData").then(function(e){console.log(e),s()},function(e){console.log(e),s()})},a)}},{key:"getChartData",value:function(e){return new Promise(function(t,a){fetch(e).then(function(e){if(200!==e.status)throw new Error(e.statusText);return console.log(e),e.json()}).then(function(e){t(e)}).catch(function(e){a(e)})})}},{key:"initData",value:function(e,t){for(var a={},n=this.startTimeHour,o=20,r=this.endTimeHour;(n<e||n===e&&o<t)&&n<r;){a[this.getTimeKey(n,o)]={},o+20>=60?(n++,o=0):o+=20}return this.lastHour=n,this.lastMinutes=o,a}},{key:"getTimeKey",value:function(e,t){return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}},{key:"getDateKey",value:function(e,t,a){return e+"-"+(t+1<10?"0"+(t+1):t+1)+"-"+(a<10?"0"+a:a)}},{key:"getLabel",value:function(){var e=new Date,t=e.getMinutes(),a=e.getSeconds();return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)}},{key:"fakeData",value:function(){var e=[0,1,-2],t=e[Math.floor(Math.random()*e.length)],a=new Date,n=this.getDateKey(a.getFullYear(),a.getMonth(),a.getDate())+"T"+this.getTimeKey(a.getHours(),a.getMinutes());return[{data:'{"s": [{"c": 0, "d": -0.5413542847002053, "t": 2002.2506371, "v": '.concat(t,'}], "t": "').concat(n,'"}')}]}},{key:"formatData",value:function(e,t,a,n){var o=this;e.forEach(function(e){var r=JSON.parse(e.data),i=new Date(r.t),s=i.getMinutes()<40?i.getHours():i.getHours()+1,c=i.getMinutes()<20?20:i.getMinutes()<40?40:0,l=o.getTimeKey(s,c);n&&(l=o.getDateKey(i.getFullYear(),i.getMonth(),i.getDate()));for(var u=0;u<r.s.length;u++)-2!==r.s[u].v&&t[l]&&(t[l][a]||(t[l][a]={val:0,count:0}),t[l][a].val+=r.s[u].v,t[l][a].count++),0===r.s[u].v||-2===r.s[u].v?t[l]&&(t[l].performance||(t[l].performance={count:0}),t[l].performance.count++):1===r.s[u].v&&t[l]&&(t[l].in_range||(t[l].in_range={count:0}),t[l].in_range.count++)})}},{key:"render",value:function(){var e=this,t=this.state,a=(t.clientId,t.redirectUri,t.stateVal,t.tokenVal,t.labels,t.stressData,t.lucidityData,t.cognitiveLoadData,t.courageData,t.chartsData),n=t.prevDaysChartsData,r=t.selectedType,i=[],s=[],c=[],l=[],u=[],d=[];if("currDay"===r)for(var h in a)i.push(h),a[h].stress?s.push(Math.round(a[h].stress.val/a[h].stress.count)):s.push(0),a[h].cognitiveLoad?c.push(Math.round(a[h].cognitiveLoad.val/a[h].cognitiveLoad.count)):c.push(0),a[h].lucidity?l.push(Math.round(a[h].lucidity.val/a[h].lucidity.count)):l.push(0),a[h].performance?u.push(a[h].performance.count):u.push(0),a[h].in_range?d.push(a[h].in_range.count):d.push(0);else for(var g in n)i.push(g),n[g]&&n[g].stress?s.push(Math.round(n[g].stress.val/n[g].stress.count)):s.push(0),n[g]&&n[g].cognitiveLoad?c.push(Math.round(n[g].cognitiveLoad.val/n[g].cognitiveLoad.count)):c.push(0),n[g]&&n[g].lucidity?l.push(Math.round(n[g].lucidity.val/n[g].lucidity.count)):l.push(0),n[g]&&n[g].performance?u.push(n[g].performance.count):u.push(0),n[g]&&n[g].in_range?d.push(n[g].in_range.count):d.push(0);var p="currDay"===r?"\u0412\u0440\u0435\u043c\u044f, \u043c\u0438\u043d":"\u0414\u0430\u0442\u0430, \u0434\u043d\u0438",m="\u041a\u043e\u043b\u043b\u0435\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c";return o.a.createElement("div",{className:"App"},o.a.createElement("a",{id:"updateTokenLink",target:"_self",style:{display:"none"}},"Token"),o.a.createElement("div",{className:"form-check form-check-inline"},o.a.createElement("input",{className:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"inlineRadio1",value:"currDay",checked:"currDay"===r,onChange:function(t){return e.setState({selectedType:"currDay"})}}),o.a.createElement("label",{className:"form-check-label",htmlFor:"inlineRadio1"},"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c")),o.a.createElement("div",{className:"form-check form-check-inline"},o.a.createElement("input",{className:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"inlineRadio2",value:"prevDays",checked:"prevDays"===r,onChange:function(t){return e.setState({selectedType:"prevDays"})}}),o.a.createElement("label",{className:"form-check-label",htmlFor:"inlineRadio2"},"\u041f\u0440\u043e\u0448\u043b\u044b\u0435 \u0434\u043d\u0438")),o.a.createElement("div",{className:"Charts"},o.a.createElement("div",{className:"chart-block"},o.a.createElement("div",{className:"chart-head"},o.a.createElement("span",{className:"label",style:{color:"rgba(".concat(this.background.lucidity.join(","),", 1)")}},"\u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u0435\u043d\u043d\u043e\u0441\u0442\u044c")),o.a.createElement("div",{className:"chart-body"},o.a.createElement(D,{id:"lucidityBar",content:[{data:l,label:"\u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u0435\u043d\u043d\u043e\u0441\u0442\u044c",color:this.background.lucidity}],labels:i,xLabel:p,yLabel:m}))),o.a.createElement("div",{className:"chart-block"},o.a.createElement("div",{className:"chart-head"},o.a.createElement("span",{className:"label",style:{color:"rgba(".concat(this.background.stress.join(","),", 1)")}},"\u0421\u0442\u0440\u0435\u0441\u0441")),o.a.createElement("div",{className:"chart-body"},o.a.createElement(D,{id:"stressBar",content:[{data:s,label:"\u0421\u0442\u0440\u0435\u0441\u0441",color:this.background.stress}],labels:i,xLabel:p,yLabel:m}))),o.a.createElement("div",{className:"chart-block"},o.a.createElement("div",{className:"chart-head"},o.a.createElement("span",{className:"label",style:{color:"rgba(".concat(this.background.cognitiveLoad.join(","),", 1)")}},"\u041a\u043e\u0433\u043d\u0438\u0442\u0438\u0432\u043d\u0430\u044f \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430")),o.a.createElement("div",{className:"chart-body"},o.a.createElement(D,{id:"cognitiveLoadBar",content:[{data:c,label:"\u041a\u043e\u0433\u043d\u0438\u0442\u0438\u0432\u043d\u0430\u044f \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430",color:this.background.cognitiveLoad}],labels:i,xLabel:p,yLabel:m}))),o.a.createElement("div",{className:"chart-block"},o.a.createElement("div",{className:"chart-head"},o.a.createElement("span",{className:"label",style:{color:"rgba(".concat(this.background.performance.join(","),", 1)")}},"\u0420\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c")),o.a.createElement("div",{className:"chart-body"},o.a.createElement(D,{id:"courageBar",content:this.isPerfomanceStacked?[{data:u,label:"\u0412\u043d\u0435 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0430/\u041d\u0435\u0442 \u0441\u0438\u0433\u043d\u0430\u043b\u0430",color:this.background.performance},{data:d,label:"\u0412 \u0434\u0438\u0430\u043f\u043e\u0437\u043e\u043d\u0435",color:this.background.in_range}]:[{data:u,label:"\u0412\u043d\u0435 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0430/\u041d\u0435\u0442 \u0441\u0438\u0433\u043d\u0430\u043b\u0430",color:this.background.performance}],labels:i,showLegend:this.isPerfomanceStacked,xLabel:p,yLabel:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0439"})))),o.a.createElement(v.NotificationContainer,null))}}]),t}(n.Component),E=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function w(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(o.a.createElement(T,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");E?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):w(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):w(t,e)})}}()},84:function(e,t,a){e.exports=a(228)}},[[84,1,2]]]);
//# sourceMappingURL=main.c2a7dc61.chunk.js.map